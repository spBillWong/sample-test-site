<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Prevent caching -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- Feature policy for geolocation -->
    <meta http-equiv="Feature-Policy" content="geolocation 'self'">
    <meta http-equiv="Permissions-Policy" content="geolocation=(self)">

    <title>Geolocation Test - Sample GitHub Site</title>
    <link rel="stylesheet" href="styles/main.css">

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .button {
            background-color: #007AFF;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            margin: 10px 5px;
            cursor: pointer;
        }
        .button:hover {
            background-color: #0056b3;
        }
        .result {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        .debug {
            background-color: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }
    </style>    
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-container">
                <h1 class="nav-logo">Sample Site</h1>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="index.html" class="nav-link">Home</a>
                    </li>
                    <li class="nav-item">
                        <a href="about.html" class="nav-link">About</a>
                    </li>
                    <li class="nav-item">
                        <a href="projects.html" class="nav-link">Projects</a>
                    </li>
                    <li class="nav-item">
                        <a href="contact.html" class="nav-link">Contact</a>
                    </li>
                    <li class="nav-item">
                        <a href="tests.html" class="nav-link">Tests</a>
                    </li>
                </ul>
                <div class="hamburger">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="page-header">
            <div class="container">
                <h1>üìç Geolocation Test</h1>
                <p>Test your browser's geolocation capabilities</p>
                <a href="tests.html" class="back-link">‚Üê Back to Tests</a>
            </div>
        </section>

        <section class="test-content">
            <div class="container">
                <!-- <div class="test-panel">
                    <div class="test-controls">
                        <h2>Geolocation API Test</h2>
                        <p>Click the button below to request your current location. Your browser will ask for permission to access your location data.</p>
                        
                        <div class="button-group">
                            <button id="getLocationBtn" class="test-action-btn">Get My Location</button>
                            <button id="watchLocationBtn" class="test-action-btn secondary">Watch Location</button>
                            <button id="stopWatchBtn" class="test-action-btn danger" disabled>Stop Watching</button>
                        </div>

                        <div id="status" class="status-message"></div>
                    </div>

                    <div class="test-results">
                        <h3>Location Results</h3>
                        <div id="locationResults" class="results-container">
                            <p class="no-data">No location data yet. Click "Get My Location" to start.</p>
                        </div>
                    </div>
                </div>

                <div class="test-info-panel">
                    <h3>About Geolocation API</h3>
                    <div class="info-content">
                        <h4>What it does:</h4>
                        <ul>
                            <li>Retrieves your device's current geographic position</li>
                            <li>Provides latitude and longitude coordinates</li>
                            <li>Can track location changes in real-time</li>
                            <li>Includes accuracy information</li>
                        </ul>

                        <h4>Privacy & Security:</h4>
                        <ul>
                            <li>Requires explicit user permission</li>
                            <li>Works best over HTTPS connections</li>
                            <li>Location data stays in your browser</li>
                            <li>You can revoke permission at any time</li>
                        </ul>

                        <h4>Accuracy depends on:</h4>
                        <ul>
                            <li>GPS availability (mobile devices)</li>
                            <li>WiFi network information</li>
                            <li>IP address geolocation</li>
                            <li>Device capabilities</li>
                        </ul>
                    </div>
                </div> -->

                <h1>üó∫Ô∏è Enhanced Geolocation Test</h1>
    
                <div class="info">
                    <strong>Instructions:</strong><br>
                    1. Open browser console for detailed logs<br>
                    2. Test different permission scenarios<br>
                    3. Check native app logs in Xcode<br>
                    4. Try different geolocation methods
                </div>
                
                <button class="button" onclick="checkPermissions()">üîç Check Permissions</button>
                <button class="button" onclick="getCurrentLocation()">üìç Get Location</button>
                <button class="button" onclick="getCurrentLocationWithTimeout()">‚è±Ô∏è Get Location (5s timeout)</button>
                <button class="button" onclick="watchPosition()">üëÅÔ∏è Watch Position</button>
                <button class="button" onclick="stopWatching()">‚èπÔ∏è Stop Watching</button>
                <button class="button" onclick="testPermissionsAPI()">üõ°Ô∏è Test Permissions API</button>
                <button class="button" onclick="clearResults()">üóëÔ∏è Clear Results</button>
                
                <div id="results"></div>
            
                <script>
                    let watchId = null;
                    
                    function log(message, type = 'info') {
                        const timestamp = new Date().toLocaleTimeString();
                        const resultDiv = document.createElement('div');
                        resultDiv.className = `result ${type}`;
                        resultDiv.textContent = `[${timestamp}] ${message}`;
                        document.getElementById('results').appendChild(resultDiv);
                        console.log(`[${timestamp}] ${message}`);
                        
                        // Auto-scroll to bottom
                        resultDiv.scrollIntoView({ behavior: 'smooth' });
                    }
                    
                    function checkPermissions() {
                        log("üîç Checking geolocation support and permissions...", 'info');
                        
                        if (!navigator.geolocation) {
                            log("‚ùå Geolocation is not supported", 'error');
                            return;
                        }
                        
                        log("‚úÖ Geolocation API is available", 'success');
                        log(`Navigator: ${navigator.userAgent}`, 'debug');
                        log(`Protocol: ${window.location.protocol}`, 'debug');
                        log(`Host: ${window.location.host}`, 'debug');
                        log(`URL: ${window.location.href}`, 'debug');
                        
                        // Check if Permissions API is available
                        if ('permissions' in navigator) {
                            log("‚úÖ Permissions API is available", 'success');
                            navigator.permissions.query({name: 'geolocation'}).then(function(result) {
                                log(`Permission state: ${result.state}`, 'info');
                            }).catch(function(error) {
                                log(`Permission check error: ${error.message}`, 'error');
                            });
                        } else {
                            log("‚ö†Ô∏è Permissions API not available", 'info');
                        }
                    }
                    
                    function getCurrentLocation() {
                        log("üîÑ Requesting current location...", 'info');
                        
                        if (!navigator.geolocation) {
                            log("‚ùå Geolocation is not supported by this browser", 'error');
                            return;
                        }
                        
                        const options = {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 0
                        };
                        
                        log(`Using options: ${JSON.stringify(options)}`, 'debug');
                        
                        navigator.geolocation.getCurrentPosition(
                            function(position) {
                                const coords = position.coords;
                                const message = `‚úÖ Location obtained:
            Latitude: ${coords.latitude}
            Longitude: ${coords.longitude}
            Accuracy: ${coords.accuracy} meters
            Altitude: ${coords.altitude || 'N/A'}
            Speed: ${coords.speed || 'N/A'}
            Heading: ${coords.heading || 'N/A'}
            Timestamp: ${new Date(position.timestamp).toLocaleString()}`;
                                log(message, 'success');
                            },
                            function(error) {
                                let errorMessage = `‚ùå Error getting location:
            Error code: ${error.code}
            Error message: ${error.message}`;
                                
                                switch(error.code) {
                                    case error.PERMISSION_DENIED:
                                        errorMessage += "\nType: Permission denied by user";
                                        break;
                                    case error.POSITION_UNAVAILABLE:
                                        errorMessage += "\nType: Position information unavailable";
                                        break;
                                    case error.TIMEOUT:
                                        errorMessage += "\nType: Location request timed out";
                                        break;
                                    default:
                                        errorMessage += "\nType: Unknown error occurred";
                                }
                                log(errorMessage, 'error');
                            },
                            options
                        );
                    }
                    
                    function getCurrentLocationWithTimeout() {
                        log("‚è±Ô∏è Requesting location with 5 second timeout...", 'info');
                        
                        const options = {
                            enableHighAccuracy: false,
                            timeout: 5000,
                            maximumAge: 60000 // 1 minute
                        };
                        
                        navigator.geolocation.getCurrentPosition(
                            function(position) {
                                log(`‚úÖ Location (5s timeout): ${position.coords.latitude}, ${position.coords.longitude}`, 'success');
                            },
                            function(error) {
                                log(`‚ùå Location error (5s timeout): Code ${error.code} - ${error.message}`, 'error');
                            },
                            options
                        );
                    }
                    
                    function watchPosition() {
                        if (watchId !== null) {
                            log("‚ö†Ô∏è Already watching position. Stop first.", 'info');
                            return;
                        }
                        
                        log("üëÅÔ∏è Starting to watch position...", 'info');
                        
                        if (!navigator.geolocation) {
                            log("‚ùå Geolocation is not supported by this browser", 'error');
                            return;
                        }
                        
                        const options = {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 5000
                        };
                        
                        watchId = navigator.geolocation.watchPosition(
                            function(position) {
                                const coords = position.coords;
                                const message = `üìç Position update:
            Lat: ${coords.latitude.toFixed(6)}, Lng: ${coords.longitude.toFixed(6)}
            Accuracy: ${coords.accuracy.toFixed(1)}m`;
                                log(message, 'success');
                            },
                            function(error) {
                                let errorMessage = `‚ùå Watch position error: Code ${error.code} - ${error.message}`;
                                log(errorMessage, 'error');
                            },
                            options
                        );
                    }
                    
                    function stopWatching() {
                        if (watchId !== null) {
                            navigator.geolocation.clearWatch(watchId);
                            watchId = null;
                            log("‚èπÔ∏è Stopped watching position", 'info');
                        } else {
                            log("‚ö†Ô∏è Not currently watching position", 'info');
                        }
                    }
                    
                    function testPermissionsAPI() {
                        if (!('permissions' in navigator)) {
                            log("‚ùå Permissions API not supported", 'error');
                            return;
                        }
                        
                        log("üõ°Ô∏è Testing Permissions API...", 'info');
                        
                        navigator.permissions.query({name: 'geolocation'}).then(function(result) {
                            log(`Permission state: ${result.state}`, result.state === 'granted' ? 'success' : 'info');
                            
                            result.onchange = function() {
                                log(`Permission changed to: ${this.state}`, 'info');
                            };
                        }).catch(function(error) {
                            log(`Permissions API error: ${error.message}`, 'error');
                        });
                    }
                    
                    function clearResults() {
                        document.getElementById('results').innerHTML = '';
                        log("üóëÔ∏è Results cleared", 'info');
                    }
                    
                    // Enhanced debugging on page load
                    window.onload = function() {
                        log("üåê Page loaded, initializing geolocation test...", 'info');
                        
                        // Basic checks
                        if (navigator.geolocation) {
                            log("‚úÖ Geolocation API is supported", 'success');
                        } else {
                            log("‚ùå Geolocation API is not supported", 'error');
                        }
                        
                        // Log environment info
                        log(`Environment Info:
            User Agent: ${navigator.userAgent}
            Platform: ${navigator.platform}
            Language: ${navigator.language}
            Cookie Enabled: ${navigator.cookieEnabled}
            Online: ${navigator.onLine}
            Protocol: ${window.location.protocol}
            Host: ${window.location.host}
            Secure Context: ${window.isSecureContext}`, 'debug');
                        
                        // Check for HTTPS
                        if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {
                            log("‚ö†Ô∏è Warning: Geolocation requires HTTPS in production", 'info');
                        }
                        
                        // Auto-check permissions
                        checkPermissions();
                    };
                    
                    // Clean up on page unload
                    window.onbeforeunload = function() {
                        if (watchId !== null) {
                            navigator.geolocation.clearWatch(watchId);
                        }
                    };
                    
                    // Add global error handler
                    window.onerror = function(msg, url, line, col, error) {
                        log(`JavaScript Error: ${msg} at ${url}:${line}:${col}`, 'error');
                        return false;
                    };
                </script>                
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 Sample GitHub Site. Built for testing purposes.</p>
        </div>
    </footer>

    <script src="scripts/main.js"></script>
    <script src="scripts/geolocation-test.js"></script>
</body>
</html> 